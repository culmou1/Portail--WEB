<!DOCTYPE html>
<html>

<head>
  <title>Projet Final</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-------------- Feuille CSS -------------->
  <!--<link type="text/css" rel="stylesheet" href="stylesheet.css"/>
  <script> - tag is used to define a client-side script, such as a JavaScript.-->
  <!-------------- JQUERY script -------------->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <!-------------- BOOTSTRAP -------------->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <!--------------  BIBLIOTHÈQUE -------------->
  <script type="text/javascript" src="/springy_m.js"></script>
  <script type="text/javascript" src="/springyui_m.js"></script>
  <!------------ SOCKET -------------->
  <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>

</head>
<body>
  <div id="header">
  <!---<a id="home" href="accuel">-->
    <span id="home"> Accueil </span>
    <span id="title">
      Service 1
      Service 2
      Service 3
    </span>
  </div>
  <div id="left-bar"></div>
  <div id="right-bar"></div>
  <div id="bottom-bar"></div>
  <div id="main">
  <div id='formulaire'>
    <p> Sommets: <input id="sommets" name="sommets"> </p>
    <p> Densite: <input id="densite" name="densite">  </p>

    <input id="service 1" name="service 1" type="submit" value="Service 1" onclick="service1()" />
    <input id="service 2" name="service 2" type="submit" value="Service 2" onclick="service2()" />
    <input id="service 3" name="service 3" type="submit" value="Service 3" onclick="service3()" />
    <div id="matrice"></div>
    <div id= "MST"></div>
  </div>
  <div id="viz"> </div>
  <script>
    var socket;
    var matrice = document.querySelector("#matrice");
    var adjalist;
    var graphJSON;
    var mst = document.querySelector("#MST");
    var viz = document.querySelector('#viz');

    function creerSocket() {

      socket = io.connect('http://localhost:8070');

      //Reçoit le JSON du graphe et l'affiche sur l'HTML avec Springy
      //et dans la console
      socket.on('graph_json', function (data) {
        graphJSON = data;
        console.log (graphJSON);
        viz.innerHTML = "<canvas id=\"springy_canvas\" width=\"960\" height=\"450\" />";
        jQuery(function(){
          var graph = new Springy.Graph();
          graph.loadJSON(graphJSON);

          var springy = jQuery('#springy_canvas').springy({graph: graph});
        });
      });

      //Reçoit la liste d'adjacence et l'affiche sur l'HTML et la console
      socket.on ('adjalist', function (data) {
        adjalist = data;
        console.log (adjalist);
        matrice.innerHTML = "<h3>Liste d'Adjacence: </h3>";
        for (var i = 0; i < adjalist.length; i++) {
          var liste = "<p><b>" + i + ": </b>";
          for (var v=0; v <adjalist.length; v++) {
            if (adjalist[i][v] !== 0) {
              liste += "[" + adjalist[i][v] + "] ";
            }
          }
          liste += "</p>";
          matrice.innerHTML += liste;
        }
      });

      //Reçoit le poids total du MST et l'affiche sur l'HTML et la console
      var cost;
      socket.on ('prim', function (data) {
        cost = data[0];
        console.log (cost);
        mst.innerHTML = "<h3>MST: </h3>";
        mst.innerHTML += "<p>"+ cost + "</p>";
        graphJSON = data[1];
        viz.innerHTML = "<canvas id=\"springy_canvas\" width=\"960\" height=\"450\" />";
        jQuery(function(){
          var graph = new Springy.Graph();
          graph.loadJSON(graphJSON);

          var springy = jQuery('#springy_canvas').springy({graph: graph});
        });
      });
    }

    //Genere le graphe
    function service1() {
      //Check si le socket existe avant...
      if (typeof socket == 'undefined') {
        creerSocket();
        service1();
      }
      //Envoie le nombre sommets et la densité au generateur de graphes
      var sommets = document.querySelector("#sommets").value;
      var densite = document.querySelector("#densite").value;
      console.log(sommets + " " + densite);
      var s = sommets + " " + densite;
      socket.emit('input_value', s);
    }
    function service2() {
      //Check si le socket existe avant...
      if (typeof socket == 'undefined') {
        creerSocket();
        service2();
      }
    }

    //Calcul le poids total du MST
    function service3() {
      //Check si le socket existe avant...
      if (typeof socket == 'undefined') {
        creerSocket();
        service3();
      }
      var input = [adjalist, graphJSON];
      //Envoie la liste d'adjacence à l'algo de Prim
      socket.emit('list_input', input);
    }

    function fermer() {
    }


  </script>

</div>
</body>
</html>
